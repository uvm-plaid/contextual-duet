
{-# OPTIONS --allow-unsolved-metas #-}
module rules where

open import lang public

-- GROUND TRUTH DYNAMIC SEMANTICS

infix 6 _âŠ¢_â‡“_

data _âŠ¢_â‡“_ : âˆ€ {N} â†’ Î³[ N ] â†’ Term N â†’ ğ“‹ â†’ Set where

  -- RLIT
  âŠ¢`â„ : âˆ€ {N} {Î³ : Î³[ N ]} {r : â„•}
      --------------------------------
    â†’ Î³ âŠ¢ (`â„ r) â‡“ ğ“‡ r

  -- BLIT
  âŠ¢`ğ”¹ : âˆ€ {N} {Î³ : Î³[ N ]} {b : ğ”¹}
      --------------------------------
    â†’ Î³ âŠ¢ (`ğ”¹ b) â‡“ ğ’· b

  -- PLUS
  âŠ¢_`+_ : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ eâ‚‚ : Term N} {râ‚ râ‚‚ : â„•}
      â†’ Î³ âŠ¢ eâ‚ â‡“ ğ“‡ râ‚
      â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‡ râ‚‚
      --------------------------------
      â†’ Î³ âŠ¢ eâ‚ `+ eâ‚‚ â‡“ ğ“‡ (râ‚ + râ‚‚)

  -- TIMES
  âŠ¢_`Ã—_ : âˆ€ {N} {Î³ : Î³[ N ]}  {eâ‚ eâ‚‚ : Term N} {râ‚ râ‚‚ : â„•}
      â†’ Î³ âŠ¢ eâ‚ â‡“ ğ“‡ râ‚
      â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‡ râ‚‚
      --------------------------------
      â†’ Î³ âŠ¢ eâ‚ `Ã— eâ‚‚ â‡“ ğ“‡ (râ‚ Ã— râ‚‚)

  -- LEQ
  âŠ¢_`â‰¤_ : âˆ€ {N} {Î³ : Î³[ N ]}  {eâ‚ eâ‚‚ : Term N} {râ‚ râ‚‚ : â„•}
      â†’ Î³ âŠ¢ eâ‚ â‡“ ğ“‡ râ‚
      â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‡ râ‚‚
      --------------------------------
      â†’ Î³ âŠ¢ eâ‚ `â‰¤ eâ‚‚ â‡“ ğ’· (râ‚ â‰¤? râ‚‚) -- NOTE: strict inequality

  -- VAR
  âŠ¢`var_ : âˆ€ {N} {Î³ : Î³[ N ]} {i : idx N} {ğ“‹ : ğ“‹}
    â†’ Î³ #[ i ] â‰¡ ğ“‹
    --------------------------------------------------
    â†’ Î³ âŠ¢  ` i â‡“ ğ“‹

  -- UNIT
  âŠ¢`tt : âˆ€ {N} {Î³ : Î³[ N ]}
    ----------------------------
    â†’ Î³ âŠ¢  tt â‡“ tt

  -- INL
  âŠ¢`inl : âˆ€ {N} {Î³ : Î³[ N ]} {e : Term N} {ğ“‹ : ğ“‹} {Ï„â‚‚ : Ï„ N}
    â†’ Î³ âŠ¢ e â‡“ ğ“‹
    --------------------------------------------------
    â†’ Î³ âŠ¢ (inl Ï„â‚‚ âˆ¥ e) â‡“ inl ğ“‹

  -- INR
  âŠ¢`inr : âˆ€ {N} {Î³ : Î³[ N ]} {e : Term N} {ğ“‹ : ğ“‹} {Ï„â‚ : Ï„ N}
    â†’ Î³ âŠ¢ e â‡“ ğ“‹
    --------------------------------------------------
    â†’ Î³ âŠ¢ (inr Ï„â‚ âˆ¥ e) â‡“ inr ğ“‹

  -- CASE-LEFT
  âŠ¢`case/l : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ : Term N} {eâ‚‚ eâ‚ƒ : Term (êœ± N)} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ inl ğ“‹â‚
    â†’ (ğ“‹â‚ âˆ· Î³) âŠ¢ eâ‚‚ â‡“ ğ“‹â‚‚
  ------------------------------------------------------------------------------------
    â†’ Î³ âŠ¢ case eâ‚ of eâ‚‚ âˆ¥ eâ‚ƒ â‡“ ğ“‹â‚‚

  -- CASE-RIGHT
  âŠ¢`case/r : âˆ€ {N} {Î³ : Î³[ N ]} {i : idx (êœ± N)} {eâ‚ : Term N} {eâ‚‚ eâ‚ƒ : Term (êœ± N)} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ inr ğ“‹â‚
    â†’ (ğ“‹â‚ âˆ· Î³) âŠ¢ eâ‚ƒ â‡“ ğ“‹â‚‚
  ------------------------------------------------------------------------------------
    â†’ Î³ âŠ¢ case eâ‚ of eâ‚‚ âˆ¥ eâ‚ƒ â‡“ ğ“‹â‚‚

  -- IF-TRUE
  âŠ¢`if-true : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ eâ‚‚ eâ‚ƒ : Term N} {ğ“‹ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ ğ’· Éª
    â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‹
  ------------------------------------------------------------------------------------
    â†’ Î³ âŠ¢ if eâ‚ âˆ¥ eâ‚‚ âˆ¥ eâ‚ƒ â‡“ ğ“‹

  -- IF-FALSE
  âŠ¢`if-false : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ eâ‚‚ eâ‚ƒ : Term N} {ğ“‹ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ ğ’· á´
    â†’ Î³ âŠ¢ eâ‚ƒ â‡“ ğ“‹
  ------------------------------------------------------------------------------------
    â†’ Î³ âŠ¢ if eâ‚ âˆ¥ eâ‚‚ âˆ¥ eâ‚ƒ â‡“ ğ“‹

  -- LET
  âŠ¢`let : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ : Term N} {eâ‚‚ : Term (êœ± N)} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’  Î³ âŠ¢ eâ‚ â‡“ ğ“‹â‚
    â†’  (ğ“‹â‚ âˆ· Î³) âŠ¢ eâ‚‚ â‡“ ğ“‹â‚‚
    -----------------------------------------------
    â†’ Î³ âŠ¢ (`let eâ‚ âˆ¥ eâ‚‚) â‡“ ğ“‹â‚‚

  -- LAM
  âŠ¢`Î» : âˆ€ {N} {Î³ : Î³[ N ]} {e : Term (êœ± N)} {Ï„ : Ï„ N}
    -----------------------------------------------
    â†’ Î³ âŠ¢ (Æ›â¦‚ Ï„ â‡’ e) â‡“ (Æ›â¦‚ e âˆ¥ Î³ )

  -- APP
  âŠ¢`app : âˆ€ {N} {Î³ Î³â€² : Î³[ N ]} {eâ€² : Term (êœ± N)} {eâ‚ eâ‚‚ : Term N} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ (Æ›â¦‚ eâ€² âˆ¥ Î³â€² )
    â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‹â‚
    â†’ ğ“‹â‚ âˆ· Î³â€² âŠ¢ eâ€² â‡“ ğ“‹â‚‚
    -----------------------------------------------------------
    â†’ Î³ âŠ¢ (eâ‚ `app eâ‚‚) â‡“ ğ“‹â‚‚

  -- PAIR
  âŠ¢`_pair_ : âˆ€ {N} {Î³ : Î³[ N ]} {eâ‚ eâ‚‚ : Term N} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ eâ‚ â‡“ ğ“‹â‚
    â†’ Î³ âŠ¢ eâ‚‚ â‡“ ğ“‹â‚‚
    -----------------------------------------------------------
    â†’ Î³ âŠ¢ eâ‚ `pair eâ‚‚ â‡“ ğ“‹â‚ pair ğ“‹â‚‚

  -- PROJ1
  âŠ¢`fst : âˆ€ {N} {Î³ : Î³[ N ]} {e : Term N} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ e â‡“ ğ“‹â‚ pair ğ“‹â‚‚
  --------------------------------------
    â†’ Î³ âŠ¢ fst e â‡“ ğ“‹â‚

  -- PROJ2
  âŠ¢`snd : âˆ€ {N} {Î³ : Î³[ N ]} {e : Term N} {ğ“‹â‚ ğ“‹â‚‚ : ğ“‹}
    â†’ Î³ âŠ¢ e â‡“ ğ“‹â‚ pair ğ“‹â‚‚
  -----------------------------------------
    â†’ Î³ âŠ¢ snd e â‡“ ğ“‹â‚‚


-- TYPING JUDGEMENT FOR TERMS --
infix 6 _âŠ¢_â¦‚_,_

data _âŠ¢_â¦‚_,_ : âˆ€ {N} â†’ Î“[ N ] â†’ Term N â†’ Ï„ N â†’ Î£[ N ] â†’ Set where

  -- RLIT
  âŠ¢`â„ : âˆ€ {N} {Î“ : Î“[ N ]} {r : â„•}
      --------------------------------
    â†’ Î“ âŠ¢ (`â„ r) â¦‚ â„T , zero

  -- BLIT
  âŠ¢`ğ”¹ : âˆ€ {N} {Î“ : Î“[ N ]} {b : ğ”¹}
      --------------------------------
    â†’ Î“ âŠ¢ (`ğ”¹ b) â¦‚ ğ”¹T , zero

  -- PLUS
  âŠ¢_`+_ : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ eâ‚‚ : Term N}
      â†’ Î“ âŠ¢ eâ‚ â¦‚ â„T , Î£â‚
      â†’ Î“ âŠ¢ eâ‚‚ â¦‚ â„T , Î£â‚‚
      --------------------------------
      â†’ Î“ âŠ¢ eâ‚ `+ eâ‚‚ â¦‚ â„T , Î£â‚ + Î£â‚‚

  -- TIMES
  âŠ¢_`Ã—_ : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ eâ‚‚ : Term N}
      â†’ Î“ âŠ¢ eâ‚ â¦‚ â„T , Î£â‚
      â†’ Î“ âŠ¢ eâ‚‚ â¦‚ â„T , Î£â‚‚
      --------------------------------
      â†’ Î“ âŠ¢ eâ‚ `Ã— eâ‚‚ â¦‚ â„T , [vec]âŒ‰ (Î£â‚ + Î£â‚‚) âŒˆâ¸¢ `âˆ â¸£

  -- LEQ
  âŠ¢_`â‰¤_ : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ eâ‚‚ : Term N}
      â†’ Î“ âŠ¢ eâ‚ â¦‚ â„T , Î£â‚
      â†’ Î“ âŠ¢ eâ‚‚ â¦‚ â„T , Î£â‚‚
      --------------------------------
      â†’ Î“ âŠ¢ eâ‚ `â‰¤ eâ‚‚ â¦‚ ğ”¹T , [vec]âŒ‰ (Î£â‚ + Î£â‚‚) âŒˆâ¸¢ `âˆ â¸£

  -- VAR
  âŠ¢`var_ : âˆ€ {N} {Î“ : Î“[ N ]} {Î£ : Î£[ N ]} {i : idx N} {Ï„ : Ï„ N}
    â†’ Î“ #[ i ] â‰¡ Ï„
    --------------------------------------------------
    â†’ Î“ âŠ¢  ` i â¦‚ Ï„ , Î£ + zero #[ i â†¦ âŸ¨ 1 âŸ© ]

  -- UNIT
  âŠ¢`tt : âˆ€ {N} {Î“ : Î“[ N ]} {i : idx N} -- {Ï„ : Ï„ N}
    --------------------------------------------------
    â†’ Î“ âŠ¢  tt â¦‚ unit , zero

  -- INL
  âŠ¢`inl : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ : Î£[ N ]} {Î£â‚‚ : Î£[ N ]} {e : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N}
    â†’ Î“ âŠ¢ e â¦‚ Ï„â‚ , Î£â‚
    --------------------------------------------------
    â†’ Î“ âŠ¢ (inl Ï„â‚‚ âˆ¥ e) â¦‚ (Ï„â‚ âˆ¥ zero âˆ” Î£â‚ âŠ• zero âˆ” zero âˆ¥ Ï„â‚‚) , zero

  -- INR
  âŠ¢`inr : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚‚ : Î£[ N ]} {e : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N}
    â†’ Î“ âŠ¢ e â¦‚ Ï„â‚‚ , Î£â‚‚
    --------------------------------------------------
    â†’ Î“ âŠ¢ (inr Ï„â‚ âˆ¥ e) â¦‚ Ï„â‚ âˆ¥ zero âˆ” zero âŠ• zero âˆ” Î£â‚‚ âˆ¥ Ï„â‚‚  , zero

  -- CASE
  âŠ¢`case : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚â‚ Î£â‚â‚‚ Î£â‚‚ Î£â‚ƒ : Î£[ N ]} {i : idx (êœ± N)} {eâ‚ : Term N} {eâ‚‚ eâ‚ƒ : Term (êœ± N)} {Ï„â‚â‚ Ï„â‚â‚‚ Ï„â‚‚ Ï„â‚ƒ Ï„â‚„ : Ï„ N} {sâ‚‚ sâ‚ƒ : Sens}
    â†’ Î“ âŠ¢ eâ‚ â¦‚ Ï„â‚â‚ âˆ¥ zero âˆ” Î£â‚â‚ âŠ• zero âˆ” Î£â‚â‚‚ âˆ¥ Ï„â‚â‚‚ , Î£â‚
    â†’ (mapâ±½ â‡§áµ— (Ï„â‚â‚ âˆ· Î“)) âŠ¢ eâ‚‚ â¦‚ (â‡§áµ— Ï„â‚‚) , sâ‚‚ âˆ· Î£â‚‚
    â†’ (mapâ±½ â‡§áµ— (Ï„â‚â‚‚ âˆ· Î“)) âŠ¢ eâ‚ƒ â¦‚ (â‡§áµ— Ï„â‚ƒ) , sâ‚ƒ âˆ· Î£â‚ƒ
    â†’ (cut (Î£â‚ + Î£â‚â‚) (â‡§áµ— Ï„â‚‚)) Ï„[âŠ”] (cut (Î£â‚ + Î£â‚â‚‚) (â‡§áµ— Ï„â‚ƒ)) â‰¡ âŸ¨ Ï„â‚„ âŸ©
  ------------------------------------------------------------------------------------
    â†’ Î“ âŠ¢ case eâ‚ of eâ‚‚ âˆ¥ eâ‚ƒ â¦‚ Ï„â‚„ , [vec]âŒ‰ Î£â‚ âŒˆâ¸¢ `âˆ â¸£ + ((sâ‚‚ â¨µ Î£â‚â‚) + Î£â‚‚) âŠ” ((sâ‚ƒ â¨µ Î£â‚â‚‚) + Î£â‚ƒ)

  -- IF
  âŠ¢`if : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ Î£â‚ƒ : Î£[ N ]} {eâ‚ eâ‚‚ eâ‚ƒ : Term N}  {Ï„ : Ï„ N}
    â†’ Î“ âŠ¢ eâ‚ â¦‚ ğ”¹T , Î£â‚
    â†’ Î“ âŠ¢ eâ‚‚ â¦‚ Ï„ , Î£â‚‚
    â†’ Î“ âŠ¢ eâ‚ƒ â¦‚ Ï„ , Î£â‚ƒ
  ------------------------------------------------------------------------------------
    â†’ Î“ âŠ¢ if eâ‚ âˆ¥ eâ‚‚ âˆ¥ eâ‚ƒ â¦‚ Ï„ , Î£â‚ + (Î£â‚‚ âŠ” Î£â‚ƒ)

  -- LET
  âŠ¢`let : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ : Term N} {eâ‚‚ : Term (êœ± N)} {Ï„â‚ : Ï„ N} {Ï„â‚‚ : Ï„ (êœ± N)} {s : Sens}
    â†’  Î“ âŠ¢ eâ‚ â¦‚ Ï„â‚ , Î£â‚
    â†’  (mapâ±½ â‡§áµ— (Ï„â‚ âˆ· Î“)) âŠ¢ eâ‚‚ â¦‚ Ï„â‚‚ , s âˆ· Î£â‚‚
    -----------------------------------------------
    â†’ Î“ âŠ¢ (`let eâ‚ âˆ¥ eâ‚‚) â¦‚  cut Î£â‚ Ï„â‚‚ , (s â¨µ Î£â‚) + Î£â‚‚

  -- LAM
  âŠ¢`Î» : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ : Î£[ êœ± N ]} {i : idx N} {e : Term (êœ± N)} {Ï„â‚ : Ï„ N} {Ï„â‚‚ : Ï„ (êœ± N)}
    â†’  (mapâ±½ â‡§áµ— (Ï„â‚ âˆ· Î“)) âŠ¢ e â¦‚ Ï„â‚‚ , Î£â‚
    -----------------------------------------------
    â†’ Î“ âŠ¢ (Æ›â¦‚ Ï„â‚ â‡’ e) â¦‚ (Æ›â¦‚ Ï„â‚ â‡’[ zero âˆ” Î£â‚ ] Ï„â‚‚) , zero

  -- APP
  âŠ¢`app : âˆ€ {N} {i : idx (êœ± N)} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ eâ‚‚ : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N} {s : Sens}
    â†’ Î“ âŠ¢ eâ‚ â¦‚ (Æ›â¦‚ Ï„â‚ â‡’[ zero âˆ” s âˆ· Î£â‚ ] â‡§áµ— Ï„â‚‚) , zero
    â†’ Î“ âŠ¢ eâ‚‚ â¦‚ Ï„â‚ , Î£â‚‚
    -----------------------------------------------------------
    â†’ Î“ âŠ¢ (eâ‚ `app eâ‚‚) â¦‚ cut Î£â‚‚ (â‡§áµ— Ï„â‚‚) , (Î£â‚ + (s â¨µ Î£â‚‚))

  -- PAIR
  âŠ¢`_pair_ : âˆ€ {N} {Î“ : Î“[ N ]} {Î£â‚ Î£â‚‚ : Î£[ N ]} {eâ‚ eâ‚‚ : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N}
    â†’ Î“ âŠ¢ eâ‚ â¦‚ Ï„â‚ , Î£â‚
    â†’ Î“ âŠ¢ eâ‚‚ â¦‚ Ï„â‚‚ , Î£â‚‚
    -----------------------------------------------------------
    â†’ Î“ âŠ¢ eâ‚ `pair eâ‚‚ â¦‚ Ï„â‚ âˆ¥ zero âˆ” Î£â‚ âŠ— zero âˆ” Î£â‚‚ âˆ¥ Ï„â‚‚ , zero

  -- PROJ1
  âŠ¢`fst : âˆ€ {N} {Î“ : Î“[ N ]} {Î£ Î£â‚ Î£â‚‚ : Î£[ N ]} {e : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N}
    â†’ Î“ âŠ¢ e â¦‚ Ï„â‚ âˆ¥ zero âˆ” Î£â‚ âŠ— zero âˆ” Î£â‚‚ âˆ¥ Ï„â‚‚ , Î£
  --------------------------------------
    â†’ Î“ âŠ¢ fst e â¦‚ Ï„â‚ , Î£ + Î£â‚

  -- PROJ2
  âŠ¢`snd : âˆ€ {N} {Î“ : Î“[ N ]} {Î£ Î£â‚ Î£â‚‚ : Î£[ N ]} {e : Term N} {Ï„â‚ Ï„â‚‚ : Ï„ N}
    â†’ Î“ âŠ¢ e â¦‚ Ï„â‚ âˆ¥ zero âˆ” Î£â‚ âŠ— zero âˆ” Î£â‚‚ âˆ¥ Ï„â‚‚ , Î£
  -----------------------------------------
    â†’ Î“ âŠ¢ snd e â¦‚ Ï„â‚‚ , Î£ + Î£â‚‚

two : Term 0
two = `â„ 2

âŠ¢two : âˆ€ {Î“ : Î“[ 0 ]} â†’ Î“ âŠ¢ two â¦‚ â„T , []
âŠ¢two = âŠ¢`â„

_ : âŸ¬ â„• âŸ­[ 2 ]
_ = 1 âˆ· 0 âˆ· []

_ : âŸ¬ â„• âŸ­[ 2 ]
_ = 1 âˆ· 0 âˆ· [] + 1 âˆ· 0 âˆ· []

_ : (1 âˆ· 0 âˆ· [] AT âŸ¬ â„• âŸ­[ 2 ]) + (1 âˆ· 0 âˆ· [] AT âŸ¬ â„• âŸ­[ 2 ]) â‰¡ (2 âˆ· 0 âˆ· [])
_ = â†¯

postulate
  âˆ£_-_âˆ£ : â„• â†’ â„• â†’ â„•

substSx/Ï„ : Sens â†’ Ï„ 1 â†’ Ï„ á´¢
substSx/Ï„ s (Æ›â¦‚ Ï„â‚ â‡’[ xâ‚ âˆ” xâ‚‚ ] Ï„â‚‚) = Æ›â¦‚ substSx/Ï„ s Ï„â‚ â‡’[ xâ‚ âˆ” {!   !} ] {!   !}
substSx/Ï„ s (Ï„â‚ âˆ¥ x âˆ” xâ‚ âŠ— xâ‚‚ âˆ” xâ‚ƒ âˆ¥ Ï„â‚‚) = (substSx/Ï„ s Ï„â‚ âˆ¥ x âˆ” {!   !} âŠ— xâ‚‚ âˆ” {!   !} âˆ¥ substSx/Ï„ s Ï„â‚‚)
substSx/Ï„ s (Ï„â‚ âˆ¥ x âˆ” xâ‚ âŠ• xâ‚‚ âˆ” xâ‚ƒ âˆ¥ Ï„â‚‚) = (substSx/Ï„ s Ï„â‚ âˆ¥ x âˆ” {!   !} âŠ• xâ‚‚ âˆ” {!   !} âˆ¥ substSx/Ï„ s Ï„â‚‚)
substSx/Ï„ s unit = unit
substSx/Ï„ s â„T = â„T
substSx/Ï„ s ğ”¹T = ğ”¹T

-- value type environment (alias)
â„¾[_] : â„• â†’ Set
â„¾[ N ] =  âŸ¬ Ï„ á´¢ âŸ­[ N ]
-- â„¾[ N ] =  Î“[ N ]

-- TYPING JUDGEMENT FOR VALUE ENVIRONMENT --

mutual
  infix 6 _âŠ¢_

  data _âŠ¢_ : âˆ€ {N} â†’ â„¾[ N ] â†’ Î³[ N ] â†’ Set where

    âŠ¢z : [] âŠ¢ []

    âŠ¢s : âˆ€ {N} {â„¾ : â„¾[ N ]} {Î³ : Î³[ N ]} {ğ“‹ : ğ“‹} {Ï„ : Ï„ 0}
      â†’ âŠ¢ ğ“‹ â¦‚ Ï„
      â†’ â„¾ âŠ¢ Î³
      --------------------------------
      â†’ (Ï„ âˆ· â„¾) âŠ¢ ğ“‹ âˆ· Î³

  -- TYPING JUDGEMENT FOR VALUES --
  infix 6 âŠ¢_â¦‚_

  data âŠ¢_â¦‚_ : ğ“‹ â†’ Ï„ á´¢ â†’ Set where

    âŠ¢ğ“‡ : âˆ€ {r : â„•}
        --------------------------------
      â†’ âŠ¢ (ğ“‡ r) â¦‚ â„T

    âŠ¢ğ’· : âˆ€ {b : ğ”¹}
        --------------------------------
      â†’ âŠ¢ (ğ’· b) â¦‚ ğ”¹T

    âŠ¢tt :
        --------------------------------
        âŠ¢ tt â¦‚ unit

    âŠ¢inl : âˆ€ {v Ï„â‚ Ï„â‚‚ sâ‚ sâ‚‚}
      â†’ âŠ¢ v â¦‚ Ï„â‚
        --------------------------------
      â†’ âŠ¢ (inl v) â¦‚ Ï„â‚ âˆ¥ sâ‚ âˆ” zero âŠ• sâ‚‚ âˆ” zero âˆ¥ Ï„â‚‚

    âŠ¢inr : âˆ€ {v Ï„â‚ Ï„â‚‚ sâ‚ sâ‚‚}
      â†’ âŠ¢ v â¦‚ Ï„â‚‚
        --------------------------------
      â†’ âŠ¢ (inr v) â¦‚ Ï„â‚ âˆ¥ sâ‚ âˆ” zero âŠ• sâ‚‚ âˆ” zero âˆ¥ Ï„â‚‚

    âŠ¢pair : âˆ€ {vâ‚ vâ‚‚ Ï„â‚ Ï„â‚‚ sâ‚ sâ‚‚}
      â†’ âŠ¢ vâ‚ â¦‚ Ï„â‚
      â†’ âŠ¢ vâ‚‚ â¦‚ Ï„â‚‚
        --------------------------------
      â†’ âŠ¢ (vâ‚ pair vâ‚‚) â¦‚ Ï„â‚ âˆ¥ sâ‚ âˆ” zero âŠ— sâ‚‚ âˆ” zero âˆ¥ Ï„â‚‚

    âŠ¢Î» : âˆ€ {N} {â„¾ : âŸ¬ Ï„ N âŸ­[ N ]} {e : Term (êœ± N)} {Î³ : Î³[ N ]} {Ï„â‚ : Ï„ N} {Ï„â‚‚ : Ï„ (êœ± N)} {Ï„â‚â€² Ï„â‚‚â€²} {s sâ€²} {Î£ Î£â€² : Î£[ N ]}
      â†’ mapâ±½ (instantiateÎ£/Ï„ Î£â€²) â„¾ âŠ¢ Î³
      â†’ mapâ±½ â‡§áµ— (Ï„â‚ âˆ· â„¾) âŠ¢ e â¦‚ Ï„â‚‚ , s âˆ· Î£
      â†’ Ï„â‚â€² â‰¡ instantiateÎ£/Ï„ Î£â€² Ï„â‚
      â†’ Ï„â‚‚â€² â‰¡ instantiateÎ£/Ï„ Î£â€² Ï„â‚‚
      â†’ sâ€² â‰¡ Î£â€² â¨° Î£
        --------------------------------
      â†’ âŠ¢ (Æ›â¦‚ e âˆ¥ Î³ ) â¦‚ Æ›â¦‚ Ï„â‚â€² â‡’[ sâ€² âˆ” s âˆ· [] ] Ï„â‚‚â€²
