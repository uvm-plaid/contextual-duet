-- the command line interface we want
--
--     `duet run <this-file> "data.csv" "labels.csv" 0.05 100 0.0001 0.0001 1`
--
-- gradient descent
-- per-iteration bound
let main =  âˆ€ m  : â„•,
              n  : â„•,
              Îµ  : â„âº,
              k  : â„•,
              Î´  : â„âº,
              Î´â€² : â„âº
              .
           pÎ» xsÂ² : ğ•„ [Lâˆ, U|m, nâ†¦ğ”» ] ,
              ys : ğ•„ [Lâˆ, U|m, 1.0â†¦ğ”» ] ,
              Îµ  : â„âº[Îµ],
              k  : â„•[k],
              Î´  : â„âº[Î´],
              Î´â€² : â„âº[Î´â€²],
              Î·  : â„,
              m  : â„•[m],
              n  : â„•[n]
              â‡’
  -- TODO: capture-avoiding substitution
  -- TODO: less than comparisons for sensitivities/privacies
  -- TODO: If we leave off (1) (the last annotation of <xs,ys>) it should still
  --       work, I think -DCD
  let mâ‚€ = mcreate @ â„•[1.0] @ n @ â„ â„•[1] (cols xs) (sÎ» i : ğ•€[1.0] , j : ğ•€[n] â‡’ 0.0) in
  aloop @ Îµ @ Î´ @ Î´â€² @ k @ <xs,ys> @ <matsub,mgauss,Îµ,Î´,Î¸> @ <mLipGrad,mclip> <xs,ys> -- <-- (1)
    (pÎ» Î¸ : ğ•„ [Lâˆ, U|1.0, nâ†¦ğ”» ] â‡’
      g â† mgauss @ Îµ @ Î´ @ â„•[1.0] @ n Îµ Î´ <xs,ys>
            (mLipGrad @ m @ n @ â„âº[1.0] @ â„âº[1.0] Î¸ (mclip @ m @ n @ ğ”» xs) ys) ;
      return (matsub @ â„•[1.0] @ n Î¸ g))
    mâ‚€
    Î´â€²
in main
